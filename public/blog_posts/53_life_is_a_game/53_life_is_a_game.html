<p>This problem is sourced from the 2021 ICPC Asia Shanghai Regional Programming Contest.</p>
<blockquote>
<p>Problem Link: <a href="https://codeforces.com/gym/103446/problem/H">https://codeforces.com/gym/103446/problem/H</a></p>
</blockquote>
<p>In this problem, you are given an undirected connected graph with <span class="math inline">\(n\)</span> cities and <span class="math inline">\(m\)</span> undirected roads. The <span class="math inline">\(i\)</span>-th city provides <span class="math inline">\(a_i\)</span> social skill points the first time you reach it. Furthermore, every road requires a certain amount of social skills to traverse. The goal is to answer <span class="math inline">\(q\)</span> queries, where a query is: What is the maximum social skill you can obtain if you start at node <span class="math inline">\(x\)</span> with <span class="math inline">\(k\)</span> social skill?</p>
<p>The bounds are:</p>
<ul>
<li><span class="math inline">\(1 \le n, m, q \le 10^5\)</span></li>
<li><span class="math inline">\(1 \le a_i \le 10^4\)</span></li>
<li><span class="math inline">\(1 \le\)</span> edge weights <span class="math inline">\(\le 10^9\)</span></li>
<li><span class="math inline">\(1 \le k \le 10^9\)</span>.</li>
</ul>
<h2 id="small-merge-solution">Small Merge Solution</h2>
<p>Suppose we have a person who starts off at city <span class="math inline">\(x\)</span> with social skill <span class="math inline">\(k\)</span>. Initially, suppose the graph starts off all <span class="math inline">\(n\)</span> nodes but no edges, and we progressively add edges of increasing skill level. Each time we add an edge weight <span class="math inline">\(w\)</span> that connects component <span class="math inline">\(X \ni x\)</span> with component <span class="math inline">\(Y\)</span>, then there are two cases:</p>
<ol type="1">
<li>The person was able to explore all of <span class="math inline">\(X\)</span>, and is able to traverse the new edge.
<ul>
<li>In this case, they will be able to explore all of <span class="math inline">\(Y\)</span> too, since every edge in <span class="math inline">\(Y\)</span> has weight at most <span class="math inline">\(w\)</span></li>
</ul></li>
<li>The person was able to explore all of <span class="math inline">\(X\)</span>, but is unable to traverse the new edge.
<ul>
<li>In this case, this person will never be able to traverse any more nodes, as every new edge after will have a weight at least as heavy as this one. In this case, we can stop here, and print out the sum of skill levels in <span class="math inline">\(X\)</span> plus <span class="math inline">\(k\)</span>.</li>
</ul></li>
</ol>
<p>This process is <span class="math inline">\(O(n+m)\)</span> for each person, so doing this per person would give a time of <span class="math inline">\(O(q(n+m))\)</span>. We can improve on this by taking advantage of small merge to handle all people at once. We start off with the no edge graph, where each one-node component also contains a set of the people which start at that node. We then run <a href="https://cp-algorithms.com/graph/mst_kruskal.html">Kruskal’s algorithm</a> on increasing edge weights to merge components together, maintaining each components sum of skills in the <a href="https://cp-algorithms.com/data_structures/disjoint_set_union.html">DSU</a>. Before each merge, we check the sets of both components and anyone who is unable to traverse the edge is removed and their final skill level is calculated, before merging the two sets together. If we sort the set by increasing skill level (e.g. using <a href="https://cplusplus.com/reference/set/set/">C++ sets</a>), then we only need to remove off the front of the set, which takes <span class="math inline">\(O(\log q)\)</span> time per person. Also, since each person is added and removed from the set at most once, this gives an amortised complexity of <span class="math inline">\(O(q \log q)\)</span>. Finally, we take care to always merge the smaller set into the larger one, so that we get an amortised complexity of <span class="math inline">\(O(q \log (q)^2)\)</span> as per <a href="https://www.ralismark.xyz/posts/small-merge">small merge</a>.</p>
<p>The total complexity is <span class="math inline">\(O(m)\log m + q\log (q)^2)\)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;bits/stdc++.h&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> pair<span class="op">&lt;</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;</span> pii<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define x </span>first</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define y </span>second</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define pb </span>push_back</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define all</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span>x<span class="op">.</span>begin<span class="op">(),</span><span class="pp"> </span>x<span class="op">.</span>end<span class="op">()</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#define sz</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="dt">int</span><span class="op">(</span>x<span class="op">.</span>size<span class="op">())</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rep</span><span class="op">(</span>i<span class="op">,</span><span class="pp"> </span>n<span class="op">)</span><span class="pp"> </span><span class="cf">for</span><span class="pp"> </span><span class="op">(</span><span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span><span class="op">=</span><span class="pp"> </span><span class="dv">0</span><span class="op">;</span><span class="pp"> </span>i<span class="pp"> </span><span class="op">&lt;</span><span class="pp"> </span><span class="op">(</span>n<span class="op">);</span><span class="pp"> </span>i<span class="op">++)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">100005</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Event <span class="op">{</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">,</span> b<span class="op">,</span> w<span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> person<span class="op">;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> <span class="kw">operator</span><span class="op">&lt;(</span><span class="at">const</span> Event <span class="op">&amp;</span>oth<span class="op">)</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>w <span class="op">==</span> oth<span class="op">.</span>w<span class="op">)</span> <span class="cf">return</span> person <span class="op">&lt;</span> oth<span class="op">.</span>person<span class="op">;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> w <span class="op">&lt;</span> oth<span class="op">.</span>w<span class="op">;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> N<span class="op">,</span> M<span class="op">,</span> Q<span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>vector<span class="op">&lt;</span>Event<span class="op">&gt;</span> es<span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ans<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> rep<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sz<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> skill<span class="op">[</span>MAXN<span class="op">];</span> <span class="co">// sum of skills in component</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>set<span class="op">&lt;</span>pii<span class="op">&gt;</span> ss<span class="op">[</span>MAXN<span class="op">];</span> <span class="co">// set of people in that component &lt;initial skill, id&gt;</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> init<span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    rep<span class="op">(</span>i<span class="op">,</span> N<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        rep<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        sz<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        skill<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> a<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> getrep<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rep<span class="op">[</span>x<span class="op">]</span> <span class="op">==</span> x <span class="op">?</span> x <span class="op">:</span> <span class="op">(</span>rep<span class="op">[</span>x<span class="op">]</span> <span class="op">=</span> getrep<span class="op">(</span>rep<span class="op">[</span>x<span class="op">]));</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> join<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> getrep<span class="op">(</span>x<span class="op">),</span> y <span class="op">=</span> getrep<span class="op">(</span>y<span class="op">);</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sz<span class="op">[</span>x<span class="op">]</span> <span class="op">&lt;</span> sz<span class="op">[</span>y<span class="op">])</span> swap<span class="op">(</span>x<span class="op">,</span> y<span class="op">);</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    rep<span class="op">[</span>y<span class="op">]</span> <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    sz<span class="op">[</span>x<span class="op">]</span> <span class="op">+=</span> sz<span class="op">[</span>y<span class="op">];</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    skill<span class="op">[</span>x<span class="op">]</span> <span class="op">+=</span> skill<span class="op">[</span>y<span class="op">];</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    ss<span class="op">[</span>x<span class="op">].</span>insert<span class="op">(</span>ss<span class="op">[</span>y<span class="op">].</span>begin<span class="op">(),</span> ss<span class="op">[</span>y<span class="op">].</span>end<span class="op">());</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    ss<span class="op">[</span>y<span class="op">].</span>clear<span class="op">();</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main <span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    ios_base<span class="op">::</span>sync_with_stdio<span class="op">(</span><span class="kw">false</span><span class="op">);</span> cin<span class="op">.</span>tie<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    cin <span class="op">&gt;&gt;</span> N <span class="op">&gt;&gt;</span> M <span class="op">&gt;&gt;</span> Q<span class="op">;</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    rep<span class="op">(</span>i<span class="op">,</span> N<span class="op">)</span> cin <span class="op">&gt;&gt;</span> a<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    rep<span class="op">(</span>i<span class="op">,</span> M<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> u<span class="op">,</span> v<span class="op">,</span> w<span class="op">;</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        cin <span class="op">&gt;&gt;</span> u <span class="op">&gt;&gt;</span> v <span class="op">&gt;&gt;</span> w<span class="op">;</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        u<span class="op">--,</span> v<span class="op">--;</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>        es<span class="op">.</span>pb<span class="op">({</span>u<span class="op">,</span> v<span class="op">,</span> w<span class="op">,</span> <span class="kw">false</span><span class="op">});</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    rep<span class="op">(</span>i<span class="op">,</span> Q<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> x<span class="op">,</span> k<span class="op">;</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>        cin <span class="op">&gt;&gt;</span> x <span class="op">&gt;&gt;</span> k<span class="op">;</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>        x<span class="op">--;</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>        es<span class="op">.</span>pb<span class="op">({</span>i<span class="op">,</span> x<span class="op">,</span> k<span class="op">,</span> <span class="kw">true</span><span class="op">});</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    sort<span class="op">(</span>all<span class="op">(</span>es<span class="op">));</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    init<span class="op">();</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">(</span>ans<span class="op">,</span> ans<span class="op">+</span>N<span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>Event e <span class="op">:</span> es<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>e<span class="op">.</span>person<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>            ss<span class="op">[</span>getrep<span class="op">(</span>e<span class="op">.</span>b<span class="op">)].</span>insert<span class="op">({</span>e<span class="op">.</span>w<span class="op">,</span> e<span class="op">.</span>a<span class="op">});</span> <span class="co">// put him into the right set</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Note: In this solution, we insert people into sets only after we </span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>            <span class="co">// we have considered all edges with weight &lt;= than it. This does not</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>            <span class="co">// effect the correctness of the solution.</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>            <span class="co">// get leaders for two components</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> x <span class="op">=</span> getrep<span class="op">(</span>e<span class="op">.</span>a<span class="op">),</span> y <span class="op">=</span> getrep<span class="op">(</span>e<span class="op">.</span>b<span class="op">);</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x <span class="op">==</span> y<span class="op">)</span> <span class="cf">continue</span><span class="op">;</span> <span class="co">// already merged</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>            <span class="co">// remove the weak people who are gated by this edge, and</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>            <span class="co">// calculate their final answer</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(!</span>ss<span class="op">[</span>x<span class="op">].</span>empty<span class="op">()</span> <span class="op">&amp;&amp;</span> ss<span class="op">[</span>x<span class="op">].</span>begin<span class="op">()-&gt;</span>x <span class="op">+</span> skill<span class="op">[</span>x<span class="op">]</span> <span class="op">&lt;</span> e<span class="op">.</span>w<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>                ans<span class="op">[</span>ss<span class="op">[</span>x<span class="op">].</span>begin<span class="op">()-&gt;</span>y<span class="op">]</span> <span class="op">=</span> ss<span class="op">[</span>x<span class="op">].</span>begin<span class="op">()-&gt;</span>x <span class="op">+</span> skill<span class="op">[</span>x<span class="op">];</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>                ss<span class="op">[</span>x<span class="op">].</span>erase<span class="op">(</span>ss<span class="op">[</span>x<span class="op">].</span>begin<span class="op">());</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(!</span>ss<span class="op">[</span>y<span class="op">].</span>empty<span class="op">()</span> <span class="op">&amp;&amp;</span> ss<span class="op">[</span>y<span class="op">].</span>begin<span class="op">()-&gt;</span>x <span class="op">+</span> skill<span class="op">[</span>y<span class="op">]</span> <span class="op">&lt;</span> e<span class="op">.</span>w<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>                ans<span class="op">[</span>ss<span class="op">[</span>y<span class="op">].</span>begin<span class="op">()-&gt;</span>y<span class="op">]</span> <span class="op">=</span> ss<span class="op">[</span>y<span class="op">].</span>begin<span class="op">()-&gt;</span>x <span class="op">+</span> skill<span class="op">[</span>y<span class="op">];</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>                ss<span class="op">[</span>y<span class="op">].</span>erase<span class="op">(</span>ss<span class="op">[</span>y<span class="op">].</span>begin<span class="op">());</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>            <span class="co">// join them together</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>            join<span class="op">(</span>x<span class="op">,</span> y<span class="op">);</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>    <span class="co">// all nodes are merged, and anyone left is able to explore all of it</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>pii p <span class="op">:</span> ss<span class="op">[</span>getrep<span class="op">(</span><span class="dv">0</span><span class="op">)])</span> <span class="op">{</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>        ans<span class="op">[</span>p<span class="op">.</span>y<span class="op">]</span> <span class="op">=</span> p<span class="op">.</span>x <span class="op">+</span> skill<span class="op">[</span>getrep<span class="op">(</span><span class="dv">0</span><span class="op">)];</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>    rep<span class="op">(</span>i<span class="op">,</span> Q<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> ans<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="jump-list-solution">Jump List Solution</h2>
<p>This idea follows from the same observations made in the small merge solution. Form a <a href="https://codeforces.com/blog/entry/85714?fbclid=IwAR2PqCRjvm8Nc3H3W1J1RQv7bgT_48ZJfrHZTpWPWXq7GA2oOLwwJesy8eA">DSU Tree</a> on the graph, and let <span class="math inline">\(w(v)\)</span> denote the weight of the edge represented by a non-leaf node <span class="math inline">\(v\)</span> in the DSU Tree. For any query, we find the last node that doesn’t prevents us going any further. This indicates that the person’s social skill level can no longer improve, and their maximum social skill will be the sum of their initial skill and the sum of the social skills gained from all the leaf nodes in the subtree.</p>
<p>We can preprocess the DSU Tree to store the sum of skill in each subtree of node <span class="math inline">\(i\)</span> as <span class="math inline">\(skill_i\)</span> in <span class="math inline">\(O(n)\)</span>. To find the highest node that we can reach for a query with initial skill <span class="math inline">\(k\)</span>, observe that to traverse up from node <span class="math inline">\(u\)</span> to its parent node <span class="math inline">\(v\)</span>, we require that <span class="math inline">\(k \ge w(v) - skill_u\)</span>. Therefore, we can use a <a href="https://cp-algorithms.com/graph/lca_binary_lifting.html">jumplist</a>, where each jump also stores the minimum initial skill required to make the jump. This allows us to query for each person the highest jump they can make in <span class="math inline">\(O(\log n)\)</span> time.</p>
<p>The final complexity is <span class="math inline">\(O(m \log m + (q+n) \log n)\)</span></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;bits/stdc++.h&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> ll<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> pair<span class="op">&lt;</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;</span> pii<span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define x </span>first</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define y </span>second</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define pb </span>push_back</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define all</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span>x<span class="op">.</span>begin<span class="op">(),</span><span class="pp"> </span>x<span class="op">.</span>end<span class="op">()</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#define sz</span><span class="op">(</span>x<span class="op">)</span><span class="pp"> </span><span class="dt">int</span><span class="op">(</span>x<span class="op">.</span>size<span class="op">())</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#define rep</span><span class="op">(</span>i<span class="op">,</span><span class="pp"> </span>n<span class="op">)</span><span class="pp"> </span><span class="cf">for</span><span class="pp"> </span><span class="op">(</span><span class="dt">int</span><span class="pp"> </span>i<span class="pp"> </span><span class="op">=</span><span class="pp"> </span><span class="dv">0</span><span class="op">;</span><span class="pp"> </span>i<span class="pp"> </span><span class="op">&lt;</span><span class="pp"> </span><span class="op">(</span>n<span class="op">);</span><span class="pp"> </span>i<span class="op">++)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">200005</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Edge <span class="op">{</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">,</span> b<span class="op">,</span> w<span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> <span class="kw">operator</span><span class="op">&lt;(</span><span class="at">const</span> Edge <span class="op">&amp;</span>oth<span class="op">)</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> w <span class="op">&lt;</span> oth<span class="op">.</span>w<span class="op">;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> N<span class="op">,</span> M<span class="op">,</span> Q<span class="op">;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span>MAXN<span class="op">];</span> <span class="co">// skill you can get from this node&#39;s subtree</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> d<span class="op">[</span>MAXN<span class="op">];</span> <span class="co">// edge weight, only non-zero for edge nodes.</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">// dsu</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> rep<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> init<span class="op">()</span> <span class="op">{</span> rep<span class="op">(</span>i<span class="op">,</span> MAXN<span class="op">)</span> rep<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i<span class="op">;</span> <span class="op">}</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> getrep<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span> <span class="cf">return</span> rep<span class="op">[</span>x<span class="op">]</span> <span class="op">==</span> x <span class="op">?</span> x <span class="op">:</span> <span class="op">(</span>rep<span class="op">[</span>x<span class="op">]</span> <span class="op">=</span> getrep<span class="op">(</span>rep<span class="op">[</span>x<span class="op">]));</span> <span class="op">}</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">// build kruskal&#39;s refactoring tree, with weights</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> par<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> G<span class="op">[</span>MAXN<span class="op">];</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> kruskal<span class="op">(</span>vector<span class="op">&lt;</span>Edge<span class="op">&gt;</span> <span class="op">&amp;</span>es<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    sort<span class="op">(</span>all<span class="op">(</span>es<span class="op">));</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    init<span class="op">();</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">(</span>par<span class="op">,</span> par<span class="op">+</span>MAXN<span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>Edge e <span class="op">:</span> es<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> x <span class="op">=</span> getrep<span class="op">(</span>e<span class="op">.</span>a<span class="op">),</span> y <span class="op">=</span> getrep<span class="op">(</span>e<span class="op">.</span>b<span class="op">);</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">// printf(&quot;a:%d b:%d, x:%d y:%d\n&quot;, e.a, e.b, x, y);</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>x <span class="op">==</span> y<span class="op">)</span> <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">// set skill level</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        a<span class="op">[</span>N<span class="op">]</span> <span class="op">=</span> a<span class="op">[</span>x<span class="op">]</span> <span class="op">+</span> a<span class="op">[</span>y<span class="op">];</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        d<span class="op">[</span>N<span class="op">]</span> <span class="op">=</span> e<span class="op">.</span>w<span class="op">;</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        <span class="co">// connect x and y to N</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        G<span class="op">[</span>N<span class="op">].</span>pb<span class="op">(</span>x<span class="op">);</span> G<span class="op">[</span>N<span class="op">].</span>pb<span class="op">(</span>y<span class="op">);</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        par<span class="op">[</span>x<span class="op">]</span> <span class="op">=</span> par<span class="op">[</span>y<span class="op">]</span> <span class="op">=</span> N<span class="op">;</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        rep<span class="op">[</span>x<span class="op">]</span> <span class="op">=</span> rep<span class="op">[</span>y<span class="op">]</span> <span class="op">=</span> N<span class="op">;</span> <span class="co">// set N to be the new leader</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>        <span class="co">// printf(&quot;kruskal: x:%d y:%d N:%d\n&quot;, x, y, N);</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        N<span class="op">++;</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="co">// build jumplist</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> jump<span class="op">[</span>MAXN<span class="op">][</span><span class="dv">18</span><span class="op">];</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> need<span class="op">[</span>MAXN<span class="op">][</span><span class="dv">18</span><span class="op">];</span> <span class="co">// how much skill you need to make the jump</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> build<span class="op">(</span><span class="dt">int</span> at<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">// printf(&quot;build: at:%d\n&quot;, at);</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    jump<span class="op">[</span>at<span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> par<span class="op">[</span>at<span class="op">];</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>par<span class="op">[</span>at<span class="op">]</span> <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> need<span class="op">[</span>at<span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> d<span class="op">[</span>par<span class="op">[</span>at<span class="op">]]</span> <span class="op">-</span> a<span class="op">[</span>at<span class="op">];</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">17</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> to <span class="op">=</span> jump<span class="op">[</span>at<span class="op">][</span>i<span class="op">-</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>to <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> jump<span class="op">[</span>at<span class="op">][</span>i<span class="op">]</span> <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>            jump<span class="op">[</span>at<span class="op">][</span>i<span class="op">]</span> <span class="op">=</span> jump<span class="op">[</span>to<span class="op">][</span>i<span class="op">-</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>            need<span class="op">[</span>at<span class="op">][</span>i<span class="op">]</span> <span class="op">=</span> max<span class="op">(</span>need<span class="op">[</span>at<span class="op">][</span>i<span class="op">-</span><span class="dv">1</span><span class="op">],</span> need<span class="op">[</span>to<span class="op">][</span>i<span class="op">-</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> to <span class="op">:</span> G<span class="op">[</span>at<span class="op">])</span> build<span class="op">(</span>to<span class="op">);</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main <span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    ios_base<span class="op">::</span>sync_with_stdio<span class="op">(</span><span class="kw">false</span><span class="op">);</span> cin<span class="op">.</span>tie<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    cin <span class="op">&gt;&gt;</span> N <span class="op">&gt;&gt;</span> M <span class="op">&gt;&gt;</span> Q<span class="op">;</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>    rep<span class="op">(</span>i<span class="op">,</span> N<span class="op">)</span> cin <span class="op">&gt;&gt;</span> a<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">&lt;</span>Edge<span class="op">&gt;</span> es<span class="op">;</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>    rep<span class="op">(</span>i<span class="op">,</span> M<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> u<span class="op">,</span> v<span class="op">,</span> w<span class="op">;</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>        cin <span class="op">&gt;&gt;</span> u <span class="op">&gt;&gt;</span> v <span class="op">&gt;&gt;</span> w<span class="op">;</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>        u<span class="op">--,</span> v<span class="op">--;</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>        es<span class="op">.</span>pb<span class="op">({</span>u<span class="op">,</span> v<span class="op">,</span> w<span class="op">});</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    <span class="co">// build dsu tree</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    kruskal<span class="op">(</span>es<span class="op">);</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span>N<span class="op">-</span><span class="dv">1</span><span class="op">);</span> <span class="co">// N-1 is the root</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    <span class="co">// handle queries</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    rep<span class="op">(</span>_<span class="op">,</span> Q<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> x<span class="op">,</span> k<span class="op">;</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>        cin <span class="op">&gt;&gt;</span> x <span class="op">&gt;&gt;</span> k<span class="op">;</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>        x<span class="op">--;</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>        <span class="co">// jump up as high as we can</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">17</span><span class="op">;</span> i <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">--)</span> <span class="op">{</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>jump<span class="op">[</span>x<span class="op">][</span>i<span class="op">]</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>need<span class="op">[</span>x<span class="op">][</span>i<span class="op">]</span> <span class="op">&gt;</span> k<span class="op">)</span> <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> jump<span class="op">[</span>x<span class="op">][</span>i<span class="op">];</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>        <span class="co">// skill is initial + sum of everything in subtree</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> a<span class="op">[</span>x<span class="op">]</span> <span class="op">+</span> k<span class="op">);</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
